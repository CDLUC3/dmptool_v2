<div class="tab-content">

  <% CustomizationsController::TABS.each_with_index do |tab, index| %>
    <div class="tab-pane<%= (index==0 ? ' active': '') %>" id="tab<%= (index+1) %>">

      <% if tab[:requirement_only] %>

        <%= render :partial => 'section_display', #level 3
                   :locals => {  :section_name => 'DMP Resources',
                                 :partial_name => tab[:partial],
                                 :collection   => @requirement.requirement_resources.send(tab[:scope]),
                                 :editable     => false }
        %>

      <% else %>

        <%= render :partial => 'section_display', #level 1
                   :locals => {  :section_name => 'Global Resources',
                                 :partial_name => tab[:partial],
                                 :collection   => @requirement.global_resources.send(tab[:scope]),
                                 :editable     => false }
        %>

        <%= render :partial => 'section_display', #levels 2 + 3
                   :locals => {  :section_name => 'DMP Resources',
                                 :partial_name => tab[:partial],
                                 :collection   => @requirement.template_resources.send(tab[:scope]) +
                                     @requirement.requirement_resources.send(tab[:scope]),
                                 :editable     => false }
        %>
      <% end %>

      <% unless tab[:requirement_only] %>

        <%= render :partial => 'section_display', #level 4
                   :locals => {  :section_name => "#{@institution.name} Resources",
                                 :partial_name => tab[:partial],
                                 :collection   => @requirement.institution_customization_resources(@institution).send(tab[:scope]),
                                 :editable     => false }
        %>

        <%= render :partial => 'section_display', #level 5
                   :locals => {  :section_name => "#{@requirements_template.name} for #{@institution.name} Resources",
                                 :partial_name => tab[:partial],
                                 :collection   => @requirement.template_customization_resources(@institution).send(tab[:scope]),
                                 :editable     => false }
        %>

      <% end %>

      <%= render :partial => 'section_display', #level 7
                 :locals => {  :section_name => 'Requirement Resources',
                               :partial_name => tab[:partial],
                               :collection   => @requirement.requirement_customization_resources(@institution).send(tab[:scope]),
                               :editable     => true }
      %>
    </div>
  <% end %>

</div>